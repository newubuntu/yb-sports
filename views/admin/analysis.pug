extends ../_layout/default.pug

block append styles
  link(href="/vendors/@coreui/chartjs/css/coreui-chartjs.css" rel="stylesheet")
  style.
    .table td, .table th {
      text-align: center;   
    }
    .pmoney, .wallet {
      text-align: right;
    }
    .input-group>input:not(.date) {
      width: 110px !important;
    }
    .start-date, .end-date {
      width: 126px !important;
    }

block scripts
  script(src='/vendors/@coreui/utils/js/coreui-utils.js')
  script(src='/vendors/@coreui/chartjs/js/coreui-chartjs.bundle.js')
  script(src='/js/admin/analysis.js')

block view
  h1 [관리자] 분석
  hr
  .fade-in.pre-hide#app
    .row
      .col-md
        .card
          .card-header
            div
              //- span 목록 ({{count}})
              span(style="margin-left:10px")
                .btn-group
                  button.btn.btn-sm.btn-primary(type="button" v-on:click="reload")
                    svg.c-icon.c-icon-lg
                      use(xlink:href="/vendors/@coreui/icons/sprites/solid.svg#cis-reload")
                  button.btn.btn-sm.btn-secondary(type="button" v-on:click="resetReload")
                    |검색조건 초기화
              hr
              .form-row
                .form-inline
                  .form-group
                    .input-group
                      .input-group-prepend
                        .input-group-text 시작일
                      input.form-control.date.start-date(type="text" readOnly)
                  .form-group
                    .input-group
                      .input-group-prepend
                        .input-group-text 종료일
                      input.form-control.date.end-date(type="text" readOnly)
                  .form-group
                    .input-group
                      .input-group-prepend
                        .input-group-text 배당조건1
                      input.form-control.search-odds1(type="number" step="0.1" min="1.1" :value="odds1?odds1:''" v-on:change="changeSearchOdds1" style="width:70px !important;")
                      .input-group-append
                        select.form-control.search-oddscon1(v-on:change="changeSearchOddsCon1" :value="oddsCon1||''")
                          option(value="") --------
                          option(value="<") 보다 작음
                          option(value="<=") 보다 작거나 같음
                          option(value="==") 같음
                          option(value=">") 보다 큼
                          option(value=">=") 보다 크거나 같음
                          option(value="!=") 같지않음
                  .form-group
                    .input-group
                      .input-group-prepend
                        .input-group-text 배당조건2
                      input.form-control.search-odds2(type="number" step="0.1" min="1.1" :value="odds2?odds2:''" v-on:change="changeSearchOdds2" style="width:70px !important;")
                      .input-group-append
                        select.form-control.search-oddscon2(v-on:change="changeSearchOddsCon2" :value="oddsCon2||''")
                          option(value="") --------
                          option(value="<") 보다 작음
                          option(value="<=") 보다 작거나 같음
                          option(value="==") 같음
                          option(value=">") 보다 큼
                          option(value=">=") 보다 크거나 같음
                          option(value="!=") 같지않음
                  .form-group
                    button.btn.btn-primary(type="button" v-on:click="reload(0)") 찾기
              //- span.float-right(style="margin-right:54px")
              hr
              .form-row
                .col-2
                  label 종목
                  #select-sports
                .col-2
                  label 배팅타입
                  #select-bettype
                //- .col-2
                  label 수익기준
                  #select-profit-main
                .col-2
                  label 유저
                  #select-user            
          .card-body.table-responsive
          .card
            .card-body
              div
                .d-flex.justify-content-between
                  div
                    h4.card-title.mb-0 통합 그래프
                    //- .small.text-mutedSeptember 2019
                  .btn-toolbar.d-none.d-md-block(role="toolbar" aria-label="Toolbar with buttons")
                    .btn-group.btn-group-toggle.mx-3(data-toggle="buttons")
                      label.btn.btn-outline-secondary(@click="reload({period:'day'})")
                        input(id="option1" type="radio" name="options" autocomplete="off")
                        |Day          
                      label.btn.btn-outline-secondary.active(@click="reload({period:'week'})")
                        input(id="option2" type="radio" name="options" autocomplete="off" checked="")
                        |Week
                      label.btn.btn-outline-secondary(@click="reload({period:'month'})")
                        input(id="option3" type="radio" name="options" autocomplete="off")
                        |Month
                      label.btn.btn-outline-secondary(@click="reload({period:'year'})")
                        input(id="option4" type="radio" name="options" autocomplete="off")
                        |Year                          
                    //- button.btn.btn-primary(type="button")
                      svg.c-icon
                        use(xlink:href="/vendors/@coreui/icons/svg/free.svg#cil-cloud-download")          
                .c-chart-wrapper(style="height:300px;margin-top:40px;")
                  canvas.chart(id="mainChart" height="300")
              div
                .d-flex.justify-content-between
                  div
                    h4.card-title.mb-0 종목별 그래프
                    //- .small.text-mutedSeptember 2019                  
                .c-chart-wrapper(style="height:300px;margin-top:40px;")
                  canvas.chart(id="sportsChart" height="300")
              div
                .d-flex.justify-content-between
                  div
                    h4.card-title.mb-0 배팅타입별 그래프
                    //- .small.text-mutedSeptember 2019                  
                .c-chart-wrapper(style="height:300px;margin-top:40px;")
                  canvas.chart(id="betTypeChart" height="300")
            .card-footer
              //- .row.text-center
                .col-sm-12.col-md.mb-sm-2.mb-0
                  .text-muted Visits
                  strong 29.703 Users (40%)
                  .progress.progress-xs.mt-2
                    .progress-bar.bg-gradient-success(role="progressbar" style="width: 40%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100")            
                .col-sm-12.col-md.mb-sm-2.mb-0
                  .text-muted Unique
                  strong 24.093 Users (20%)
                  .progress.progress-xs.mt-2
                    .progress-bar.bg-gradient-info(role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100")            
                .col-sm-12.col-md.mb-sm-2.mb-0
                  .text-muted Pageviews
                  strong 78.706 Views (60%)
                  .progress.progress-xs.mt-2
                    .progress-bar.bg-gradient-warning(role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100")
                .col-sm-12.col-md.mb-sm-2.mb-0
                  .text-muted New Users
                  strong 22.123 Users (80%)
                  .progress.progress-xs.mt-2
                    .progress-bar.bg-gradient-danger(role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100")            
                .col-sm-12.col-md.mb-sm-2.mb-0
                  .text-muted Bounce Rate
                  strong 40.15%
                  .progress.progress-xs.mt-2
                    .progress-bar(role="progressbar" style="width: 40%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100")
            
            //- table.table.table-sm.table-responsive-sm.table-striped.table-hover.table-bordered(style="font-size: 8pt")
              thead
                tr
                  th(colspan="6")
                  th.bg-primary(colspan="6")
                    img.c-icon.mr-2(src="/assets/img/pn-icon.png")
                    | 피나클
                  th.bg-success(colspan="6")
                    img.c-icon.mr-2(src="/assets/img/bet365-icon.png")
                    | 벳365
                  th.bg-danger(colspan="2") 수익 / 배팅시간
                tr
                  th #
                  th 유저
                  th BetID
                  th 수정
                  th 종목
                  th 리그/이벤트
                  //-th 이벤트
                  th team/side
                  th 타입
                  th 배당
                  th 배팅금액
                  th 계산
                  th 상태
                  th ID
                  th team/side
                  th 타입
                  th 배당
                  th 배팅금액
                  th 계산
                  th 수익(수익률)
                  th 배팅시간                  
              tbody
                tr(v-for="item, i in list")
                  td {{i+1}}
                  td 
                    a(:href="'#'+tab" style="cursor:pointer" v-on:click="reload(0, tab, {email:item.user?item.user.email:''})")
                      |{{item.user?item.user.email:""}}
                  td
                    a(:href="'#'+tab" style="cursor:pointer" v-on:click="reload(0, tab, {betId:item.betId})")
                      |{{item.betId}}
                  td
                    button.btn.btn-sm.btn-primary(v-if="user.master" type="button" v-on:click="openEditModal(item)")
                      |수정
                  td {{item.sportName}}
                  //-리그/이벤트
                  td 
                    |{{item.event.leagueName}}
                    br
                    a(:href="'#'+tab" style="cursor:pointer" v-on:click="reload(0, tab, {eventName:item.event.betburger.pinnacle.eventName})")
                      |{{item.event.betburger.pinnacle.eventName}}
                  //-td {{item.event.betburger.pinnacle.eventName}}
                  // pinnacle
                  td {{getSide(item, 'pinnacle')}}
                  //-타입
                  td
                    |{{item.event.betburger.pinnacle.type.code + " " + item.event.betburger.pinnacle.type.set}}
                    br
                    a(:href="'#'+tab" style="cursor:pointer" v-on:click="reload(0, tab, {betType:item.betType})")
                      |{{item.betType}}
                  td {{item.siteOdds}}
                  td ${{item.siteStake}}
                  td(:class="getStatusColor(item)") {{item.pncResult}}
                  td(:class="getStatusColor(item)")
                    a(style="cursor:pointer" v-on:click="reload(0, tab, {status:item.betStatus})")
                      |{{item.betStatus}}
                  // bet365
                  td 
                    a(:href="'#'+tab" style="cursor:pointer" v-on:click="reload(0, tab, {accountId:item.account.id})")
                      |{{item.account.id}}                  
                  td {{getSide(item, 'bet365')}}
                  td 
                    a(:href="item.event.betburger.bet365.betLink" target="_blank")
                      |{{item.event.betburger.bet365.type.code + " " + item.event.betburger.bet365.type.set}}
                  td {{item.bookmakerOdds}}
                  td ${{item.bookmakerStake}}
                  td(:class="getStatusColor(item, true)") {{item.bet365Result}}
                  td {{printProfit(item)}} ({{printProfitP(item)}})
                  td {{(new Date(item.createdAt)).toLocaleString()}}                  
          //- nav
            ul.pagination.justify-content-center(v-if="list.length>0")
              li.page-item
                a.page-link(v-if="startPage>0" href="#" aria-label="Previous" v-on:click="reload(startPage-1)")
                  span(aria-hidden="true") «
                  span.sr-only Previous
              li.page-item(v-for="i in pages" :class="curPage==i?'active':''")
                a.page-link(v-if="curPage==i") {{i+1}}
                a.page-link(v-else href="#" v-on:click="reload(i)") {{i+1}}
              li.page-item
                a.page-link(v-if="maxPage>endPage" href="#" aria-label="Next" v-on:click="reload(endPage+1)")
                  span(aria-hidden="true") »
                  span.sr-only Next
